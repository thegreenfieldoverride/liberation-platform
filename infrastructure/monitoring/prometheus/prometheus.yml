# Liberation Platform - Prometheus Configuration
# Metrics collection for all services

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    environment: '${ENVIRONMENT:-local}'

# Alerting rules
rule_files:
  - '/etc/prometheus/alerts/*.yml'

# Scrape configurations
scrape_configs:
  # =============================================================================
  # CORE APPLICATION SERVICES
  # =============================================================================

  # Liberation Platform (Next.js web app)
  - job_name: 'liberation-platform'
    static_configs:
      - targets: ['liberation-platform:3000']
    metrics_path: '/health'
    scrape_interval: 30s
    scrape_timeout: 10s

  # Liberation Guardian (Go microservice)
  - job_name: 'liberation-guardian'
    static_configs:
      - targets: ['liberation-guardian:9000']
    metrics_path: '/metrics'
    scrape_interval: 15s
    scrape_timeout: 10s

  # Liberation Analytics
  - job_name: 'liberation-analytics'
    static_configs:
      - targets: ['liberation-analytics:8080']
    metrics_path: '/metrics'
    scrape_interval: 30s
    scrape_timeout: 10s

  # =============================================================================
  # DATA SERVICES
  # =============================================================================

  # Redis metrics via exporter
  - job_name: 'redis'
    static_configs:
      - targets: ['liberation-redis-exporter:9121']
    scrape_interval: 30s

  # PostgreSQL metrics (if postgres_exporter is added)
  # - job_name: 'postgres'
  #   static_configs:
  #     - targets: ['liberation-postgres-exporter:9187']
  #   scrape_interval: 30s

  # =============================================================================
  # MAIL SERVICE
  # =============================================================================

  # Postfix metrics
  - job_name: 'postfix'
    static_configs:
      - targets: ['liberation-postfix:9154']
    scrape_interval: 60s
    scrape_timeout: 30s

  # =============================================================================
  # MONITORING INFRASTRUCTURE
  # =============================================================================

  # Prometheus self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # Grafana monitoring
  - job_name: 'grafana'
    static_configs:
      - targets: ['liberation-grafana:3000']
    metrics_path: '/metrics'
    scrape_interval: 30s
