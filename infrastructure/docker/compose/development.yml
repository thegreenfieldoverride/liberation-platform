# Liberation Platform - Development Overrides
# Use with: docker compose -f base.yml -f development.yml up
#
# This file provides development-specific settings:
# - Builds from source instead of pulling images
# - Exposes debug ports
# - Mounts source code for hot reloading
# - Relaxed resource limits

name: liberation-platform

services:
  liberation-platform:
    build:
      context: ../../..
      dockerfile: infrastructure/docker/images/platform.Dockerfile
      args:
        DEPLOYMENT_TARGET: docker
    # Override to use local port for dev (use PLATFORM_PORT env var or default 3333)
    ports:
      - "${PLATFORM_PORT:-3333}:3000"
    environment:
      - NODE_ENV=development
      - ENVIRONMENT=local
      - DEBUG=true
    # Mount source for development (optional - requires different Dockerfile setup)
    # volumes:
    #   - ../../../apps/web:/app/apps/web
    #   - ../../../packages:/app/packages

  liberation-guardian:
    profiles: ["full", "guardian"]
    build:
      context: ../../..
      dockerfile: liberation-guardian/Dockerfile
    environment:
      - GIN_MODE=debug
      - LOG_LEVEL=debug

  liberation-redis:
    profiles: ["full", "guardian", "mail"]
    # Expose Redis CLI port for debugging
    ports:
      - "6379:6379"

  liberation-postgres:
    profiles: ["full"]
    # Expose Postgres for local tooling
    ports:
      - "5432:5432"
    environment:
      # Simpler password for dev
      POSTGRES_PASSWORD: liberation_dev

  liberation-postfix:
    profiles: ["full", "mail"]
    environment:
      # Allow local testing without real DKIM
      - DKIM_ENABLED=false
      - RATE_LIMIT_PER_MINUTE=1000
      - RATE_LIMIT_PER_HOUR=10000
